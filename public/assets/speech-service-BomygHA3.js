const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-CwUGm3XO.js","assets/index-zT6iaBM8.js","assets/index-B6v_s6_V.css"])))=>i.map(i=>d[i]);
import{r as g,_ as m,C as d}from"./index-zT6iaBM8.js";const c=g("SpeechRecognition",{web:()=>m(()=>import("./web-CwUGm3XO.js"),__vite__mapDeps([0,1,2])).then(h=>new h.SpeechRecognitionWeb)});class p{constructor(){this.recognition=null,this.isListening=!1,this.isEnabled=!1,this.handlers=[],this.voiceCommands=new Map,this.continuousMode=!1,this.lastCommandTime=0,this.commandTimeout=5e3,this.isNativePlatform=!1}async initialize(){try{if(this.isNativePlatform=d.isNativePlatform(),this.isNativePlatform)try{return await c.requestPermissions(),await c.available()?(console.log("âœ“ Native speech recognition initialized"),!0):(console.warn("Native speech recognition not available"),!1)}catch(e){return console.error("Failed to initialize native speech recognition:",e),!1}else{const e=window.SpeechRecognition||window.webkitSpeechRecognition;return e?(this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!1,this.recognition.lang="en-US",this.recognition.maxAlternatives=3,this.recognition.onstart=()=>{this.isListening=!0,this.triggerEvent({type:"listening-start"}),console.log("ðŸŽ¤ Speech recognition started")},this.recognition.onend=()=>{this.isListening=!1,this.triggerEvent({type:"listening-end"}),console.log("ðŸŽ¤ Speech recognition ended"),this.continuousMode&&this.isEnabled&&setTimeout(()=>{this.isEnabled&&!this.isListening&&this.startListening()},1e3)},this.recognition.onresult=t=>{var r,l,a;const i=Array.from(t.results),o=i[i.length-1],n=((l=(r=o==null?void 0:o[0])==null?void 0:r.transcript)==null?void 0:l.toLowerCase())||"",s=((a=o==null?void 0:o[0])==null?void 0:a.confidence)||0;console.log(`ðŸŽ¤ Speech recognized: "${n}" (confidence: ${s.toFixed(2)})`),n&&this.processVoiceCommand(n,s)},this.recognition.onerror=t=>{if(console.error("Speech recognition error:",t.error),t.error==="aborted"&&!this.isEnabled){console.log("ðŸŽ¤ Speech recognition properly stopped");return}this.triggerEvent({type:"error",error:t.error})},this.recognition.onnomatch=()=>{console.log("ðŸŽ¤ No speech match found"),this.triggerEvent({type:"no-match"})},console.log("âœ“ Web speech recognition service initialized"),!0):(console.warn("Speech recognition not supported in this browser"),!1)}}catch(e){return console.error("Failed to initialize speech recognition:",e),!1}}processVoiceCommand(e,t){const i=Date.now();if(i-this.lastCommandTime<2e3){console.log("ðŸŽ¤ Command ignored - too soon after previous command");return}for(const[o,n]of Array.from(this.voiceCommands.entries())){const s=n.phrases.find(r=>r.toLowerCase().split(" ").every(a=>e.includes(a)));if(s&&t>.6){console.log(`ðŸŽ¤ Voice command matched: ${o} ("${s}")`),this.triggerEvent({type:"command-recognized",command:o,confidence:t,transcript:e});try{n.action(),this.lastCommandTime=i,this.continuousMode||setTimeout(()=>{this.stopListening()},100)}catch(r){console.error(`Error executing voice command ${o}:`,r)}return}}console.log(`ðŸŽ¤ No matching voice command for: "${e}"`),this.triggerEvent({type:"no-match",transcript:e})}registerCommand(e,t){this.voiceCommands.set(e,t),console.log(`ðŸŽ¤ Registered voice command: ${e} - ${t.phrases.join(", ")}`)}unregisterCommand(e){this.voiceCommands.delete(e)}async startListening(e=!1){if(this.isListening)return!1;try{if(this.continuousMode=e,this.isEnabled=!0,this.isNativePlatform){this.isListening=!0,this.triggerEvent({type:"listening-start"});const t=await c.start({language:"en-US",maxResults:3,prompt:"Speak a command",partialResults:!1,popup:!0});if(t.matches&&t.matches.length>0){const i=t.matches[0].toLowerCase(),o=.8;console.log(`ðŸŽ¤ Native speech recognized: "${i}"`),this.processVoiceCommand(i,o)}return this.isListening=!1,this.triggerEvent({type:"listening-end"}),!0}else return this.recognition?(this.recognition.start(),!0):!1}catch(t){return console.error("Failed to start speech recognition:",t),this.isListening=!1,this.triggerEvent({type:"error",error:t instanceof Error?t.message:String(t)}),!1}}stopListening(){if(this.isEnabled=!1,this.continuousMode=!1,this.isNativePlatform)try{c.stop(),console.log("ðŸ›‘ Native speech recognition stop requested")}catch(e){console.warn("Native speech recognition stop error:",e)}else if(this.recognition)try{this.recognition.stop(),console.log("ðŸ›‘ Web speech recognition stop requested")}catch(e){console.warn("Web speech recognition stop error (expected):",e)}this.isListening=!1}isCurrentlyListening(){return this.isListening}isSpeechEnabled(){return this.isEnabled}isSupported(){return this.isNativePlatform?!0:!!(window.SpeechRecognition||window.webkitSpeechRecognition)}on(e){this.handlers.push(e)}off(e){const t=this.handlers.indexOf(e);t>-1&&this.handlers.splice(t,1)}triggerEvent(e){this.handlers.forEach(t=>{try{t(e)}catch(i){console.error("Error in speech event handler:",i)}})}getSettings(){return{enabled:localStorage.getItem("platemate-speech-enabled")==="true",continuous:localStorage.getItem("platemate-speech-continuous")==="true",wakeWord:localStorage.getItem("platemate-wake-word")||"hey platemate",voiceConfirmation:localStorage.getItem("platemate-voice-confirmation")!=="false"}}updateSettings(e){Object.entries(e).forEach(([t,i])=>{i!==void 0&&localStorage.setItem(`platemate-${t.replace(/([A-Z])/g,"-$1").toLowerCase()}`,i.toString())})}getAvailableCommands(){return Array.from(this.voiceCommands.values())}}const f=new p;export{f as speechService};
